= content_for :javascripts do
	:coffeescript
		$ ->
			# Fix table collapse, solution from http://www.foliotek.com/devblog/make-table-rows-sortable-using-jquery-ui-sortable/.
			fixHelper = (e, ui) ->
				ui.children().each( () -> $(this).width( $(this).width() ) )
				return ui
				
			$( '#all_variants' ).sortable({ 
				items: 		 '.variant'
				handle: 	 '.handle'
				tolerance: 'pointer' ,
				helper: fixHelper
				update: () -> 
					$.ajax({ 
						type: 'post'
						url:  '/manage/goods/#{ good.id }/variants/sort'
						data: $( this ).sortable( 'serialize' )
						dataType: 'script'
					}) 
				})

#variants
	%h2 Variants
	%table#all_variants
		%thead
			%tr
				%th
				- for option in good_options
					%th= label_tag "variant_option_value_#{ option.position }", option.name
				%th= label_tag "variant_price", 'Price'
				%th
	
		%tbody
			- for variant in good_variants
				%tr[ variant ]
					%td.handle= image_tag 'icons/drag_handle.gif'
					- for option in good_options
						%td.option= eval( "variant.option_value_#{ option.position }" )
					%td.price= variant.price.format
					%td
						= link_to 'Edit', edit_manage_good_variant_path( good, variant )
						Â·
						= link_to 'Delete', manage_good_variant_path( good, variant ), method: :delete, confirm: "Are you sure you want to delete this variant?"
	
		%tbody#add_variant
			%tr
				= form_for [ :manage, good, new_variant ] do |f|
					- for option in good_options
						%td.option= f.text_field :"option_value_#{ option.position }", placeholder: "Option #{ option.position }"
					%td.price= f.text_field :price
			
					%td= f.submit 'Add Variant'